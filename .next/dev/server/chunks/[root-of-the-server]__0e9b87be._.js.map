{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///Users/latinittn/Documents/theanun_liza/lib/googleSheets.ts"],"sourcesContent":["import { GoogleSpreadsheet } from 'google-spreadsheet';\nimport { JWT } from 'google-auth-library';\n\n// Initialize the sheet - reusing the client if already initialized\nlet doc: GoogleSpreadsheet | null = null;\n\nexport async function getDoc() {\n    // If doc is set, it means we successfully loaded it previously\n    if (doc) return doc;\n\n    if (!process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL || !process.env.GOOGLE_PRIVATE_KEY || !process.env.GOOGLE_SHEET_ID) {\n        throw new Error('Missing Google Sheets environment variables');\n    }\n\n    const serviceAccountAuth = new JWT({\n        email: process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL,\n        key: process.env.GOOGLE_PRIVATE_KEY.replace(/\\\\n/g, '\\n'),\n        scopes: [\n            'https://www.googleapis.com/auth/spreadsheets',\n        ],\n    });\n\n    const newDoc = new GoogleSpreadsheet(process.env.GOOGLE_SHEET_ID, serviceAccountAuth);\n    await newDoc.loadInfo();\n\n    // Only assign to global variable if loadInfo succeeded\n    doc = newDoc;\n\n    return doc;\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,mEAAmE;AACnE,IAAI,MAAgC;AAE7B,eAAe;IAClB,+DAA+D;IAC/D,IAAI,KAAK,OAAO;IAEhB,IAAI,CAAC,QAAQ,GAAG,CAAC,4BAA4B,IAAI,CAAC,QAAQ,GAAG,CAAC,kBAAkB,IAAI,CAAC,QAAQ,GAAG,CAAC,eAAe,EAAE;QAC9G,MAAM,IAAI,MAAM;IACpB;IAEA,MAAM,qBAAqB,IAAI,wMAAG,CAAC;QAC/B,OAAO,QAAQ,GAAG,CAAC,4BAA4B;QAC/C,KAAK,QAAQ,GAAG,CAAC,kBAAkB,CAAC,OAAO,CAAC,QAAQ;QACpD,QAAQ;YACJ;SACH;IACL;IAEA,MAAM,SAAS,IAAI,0MAAiB,CAAC,QAAQ,GAAG,CAAC,eAAe,EAAE;IAClE,MAAM,OAAO,QAAQ;IAErB,uDAAuD;IACvD,MAAM;IAEN,OAAO;AACX"}},
    {"offset": {"line": 151, "column": 0}, "map": {"version":3,"sources":["file:///Users/latinittn/Documents/theanun_liza/app/api/join/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { getDoc } from '@/lib/googleSheets';\n\nexport async function GET() {\n    try {\n        const doc = await getDoc();\n        const sheet = doc.sheetsByIndex[0]; // Access the first sheet\n        const rows = await sheet.getRows();\n\n        const guests = rows.map(row => ({\n            name: row.get('name'),\n            guests: parseInt(row.get('guests'), 10),\n            attending: row.get('attending'),\n            message: row.get('message'),\n            timestamp: row.get('timestamp'),\n        }));\n\n        return NextResponse.json({\n            count: guests.length, // Or calculate total guests if needed: guests.reduce((sum, g) => sum + g.guests, 0)\n            guests: guests\n        });\n    } catch (error) {\n        console.error('Error reading from Google Sheets:', error);\n        return NextResponse.json({ count: 0, guests: [], error: 'Failed to fetch data' });\n    }\n}\n\n\nexport async function POST(request: Request) {\n    try {\n        const body = await request.json();\n\n        // Basic validation\n        if (!body || !body.name) {\n            return NextResponse.json({ error: 'Name is required' }, { status: 400 });\n        }\n\n        const newGuest = {\n            name: body.name,\n            guests: body.guests || 1,\n            attending: body.attending || 'yes',\n            message: body.message || '',\n            timestamp: new Date().toISOString()\n        };\n\n        const doc = await getDoc();\n        const sheet = doc.sheetsByIndex[0];\n\n        // Check if headers exist, if not set them\n        let headersLoaded = false;\n        try {\n            await sheet.loadHeaderRow();\n            headersLoaded = true;\n        } catch (e) {\n            // If loading headers fails (e.g. empty sheet), we'll set them below\n        }\n\n        if (!headersLoaded || sheet.headerValues.length === 0) {\n            await sheet.setHeaderRow(['name', 'guests', 'attending', 'message', 'timestamp']);\n        }\n\n        await sheet.addRow(newGuest);\n\n        return NextResponse.json({ success: true });\n    } catch (error) {\n        console.error(\"Error adding to Google Sheets:\", error);\n        return NextResponse.json({ error: 'Failed to save guest' }, { status: 500 });\n    }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,eAAe;IAClB,IAAI;QACA,MAAM,MAAM,MAAM,IAAA,4JAAM;QACxB,MAAM,QAAQ,IAAI,aAAa,CAAC,EAAE,EAAE,yBAAyB;QAC7D,MAAM,OAAO,MAAM,MAAM,OAAO;QAEhC,MAAM,SAAS,KAAK,GAAG,CAAC,CAAA,MAAO,CAAC;gBAC5B,MAAM,IAAI,GAAG,CAAC;gBACd,QAAQ,SAAS,IAAI,GAAG,CAAC,WAAW;gBACpC,WAAW,IAAI,GAAG,CAAC;gBACnB,SAAS,IAAI,GAAG,CAAC;gBACjB,WAAW,IAAI,GAAG,CAAC;YACvB,CAAC;QAED,OAAO,6KAAY,CAAC,IAAI,CAAC;YACrB,OAAO,OAAO,MAAM;YACpB,QAAQ;QACZ;IACJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,qCAAqC;QACnD,OAAO,6KAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAAG,QAAQ,EAAE;YAAE,OAAO;QAAuB;IACnF;AACJ;AAGO,eAAe,KAAK,OAAgB;IACvC,IAAI;QACA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,mBAAmB;QACnB,IAAI,CAAC,QAAQ,CAAC,KAAK,IAAI,EAAE;YACrB,OAAO,6KAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QAC1E;QAEA,MAAM,WAAW;YACb,MAAM,KAAK,IAAI;YACf,QAAQ,KAAK,MAAM,IAAI;YACvB,WAAW,KAAK,SAAS,IAAI;YAC7B,SAAS,KAAK,OAAO,IAAI;YACzB,WAAW,IAAI,OAAO,WAAW;QACrC;QAEA,MAAM,MAAM,MAAM,IAAA,4JAAM;QACxB,MAAM,QAAQ,IAAI,aAAa,CAAC,EAAE;QAElC,0CAA0C;QAC1C,IAAI,gBAAgB;QACpB,IAAI;YACA,MAAM,MAAM,aAAa;YACzB,gBAAgB;QACpB,EAAE,OAAO,GAAG;QACR,oEAAoE;QACxE;QAEA,IAAI,CAAC,iBAAiB,MAAM,YAAY,CAAC,MAAM,KAAK,GAAG;YACnD,MAAM,MAAM,YAAY,CAAC;gBAAC;gBAAQ;gBAAU;gBAAa;gBAAW;aAAY;QACpF;QAEA,MAAM,MAAM,MAAM,CAAC;QAEnB,OAAO,6KAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC7C,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,6KAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAuB,GAAG;YAAE,QAAQ;QAAI;IAC9E;AACJ"}}]
}